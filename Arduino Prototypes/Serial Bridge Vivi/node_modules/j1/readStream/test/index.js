const assert = require('assert');
const PassThrough = require('stream').PassThrough;
const readStream = require('..');

describe('readStream', function () {

	it('should read a readable stream and return a buffer', function () {
		const stream = new PassThrough();
		const data1 = 'Hello';
		const data2 = 'こんにちは！';
		process.nextTick(function () {
			stream.write(data1);
			stream.write(data2);
			stream.end();
		});
		return readStream(stream)
			.then((buffer) => {
				assert.equal(buffer.equals(Buffer.from(data1 + data2)), true);
			});
	});

	it('should read a readable stream and return a string', function () {
		const stream = new PassThrough();
		const data1 = 'Hello';
		const data2 = 'こんにちは！';
		process.nextTick(function () {
			stream.write(data1);
			stream.write(data2);
			stream.end();
		});
		stream.setEncoding('utf8');
		return readStream(stream)
			.then((string) => {
				assert.equal(string, data1 + data2);
			});
	});

});
