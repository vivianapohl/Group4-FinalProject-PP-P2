const path = require('path');

const fallback = ['text/plain', '.txt'];
let knownTypes = null;

function mimeType(fileName) {
	const ext = path.extname(fileName);
	return (knownTypes.find((type) => {
		return type.includes(ext);
	}) || fallback)[0];
}

mimeType.extname = (contentType) => {
	const [mimeTypeString] = contentType.split(/\s*;\s*/);
	return (knownTypes.find((type) => {
		return type[0] === mimeTypeString;
	}) || fallback)[1];
};

mimeType.add = (...args) => {
	knownTypes.push(args);
};

mimeType.clear = () => {
	knownTypes = [];
};

mimeType.list = () => {
	return JSON.parse(JSON.stringify(knownTypes));
};

mimeType.reset = () => {
	knownTypes = [
		['text/html', '.html', '.htm'],
		['text/css', '.css'],
		['application/javascript', '.js', '.es', '.mjs'],
		['image/jpeg', '.jpg', '.jpeg'],
		['image/png', '.png'],
		['image/gif', '.gif'],
		['image/svg+xml', '.svg'],
		['application/x-font-ttf', '.ttf'],
		['application/x-font-otf', '.otf'],
		['application/font-woff', '.woff']
	];
};

mimeType.reset();
module.exports = mimeType;
